<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Feuerwehr Zeitmessung</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>
<body>

{% include 'navbar.html' %}

<div class="container mt-4">

    <!-- Card f√ºr Top 10 Zeiten -->
    <div class="card mb-5 shadow-sm">
        <div class="card-header text-center">
            üèÜ Beste 10 Zeiten aller Gruppen
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                    <tr>
                        <th>Gruppe</th>
                        <th>Zeit (s)</th>
                        <th>Datum</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for entry in top_entries %}
                        <tr>
                            <td>{{ entry.group_name }}</td>
                            <td>{{ "%.2f"|format(entry.time) }}</td>
                            <td>{{ entry.timestamp.strftime('%d.%m.%Y %H:%M') }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Card f√ºr Zeitverlauf -->
    <div class="card shadow-sm">
        <div class="card-header text-center">
            üìà Zeitverlauf nach Gruppen
        </div>
        <div class="card-body">
            <div id="lineChart" style="height: 500px;"></div>
        </div>
    </div>

</div>

<script>
    const groupedData = JSON.parse('{{ grouped_data | tojson | safe }}');

    const traces = Object.entries(groupedData).map(([group, data]) => ({
        x: data.timestamps,
        y: data.times,
        mode: 'lines+markers',
        name: group
    }));

    const layout = {
        title: '',
        xaxis: {
            title: 'Zeitpunkt',
            type: 'date'
        },
        yaxis: {
            title: 'Zeit (Sekunden)',
            rangemode: 'tozero'
        },
        showlegend: true,
        legend: {
            orientation: "h",
            x: 0.5,
            xanchor: "center",
            y: 1.15
        },
        margin: {t: 30}
    };

    Plotly.newPlot('lineChart', traces, layout, {responsive: true});
</script>

</body>
</html>
